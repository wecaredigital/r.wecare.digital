## post-request.json (API Gateway â†’ DynamoDB UpdateItem/Create)

#set( $remark = $util.defaultIfNull($input.json('$.remark'), "") )

{
  "TableName": "SlipLink-LinkTable-A2SD9C321JCE",
  "ConditionExpression": "attribute_not_exists(id)",
  "Key": {
    "id": {
      "S": $input.json('$.id') + "_" + $context.authorizer.claims.email
    }
  },
  "ExpressionAttributeNames": {
    "#u":  "url",
    "#o":  "owner",
    "#ts": "timestamp",
    "#r":  "remark"
  },
  "ExpressionAttributeValues": {
    ":u":  { "S": $input.json('$.url') },
    ":o":  { "S": "$context.authorizer.claims.email" },
    ":ts": { "S": "$context.requestTime" },
    ":r":  { "S": "$remark" }
  },
  "UpdateExpression": "SET #u = :u, #o = :o, #ts = :ts, #r = :r",
  "ReturnValues": "ALL_NEW"
}
